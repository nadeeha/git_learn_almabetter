def generate_flash_prompt_strict_l6(row, theme_col, theme_definitions):
    theme_name = theme_col
    theme_definition = theme_definitions.get(theme_name, "No definition provided.")

    return f"""
You are an expert in ESG and thematic investing.

Your task is to evaluate how strongly a given revenue stream (represented by a hierarchy of L1–L6 categories) 
fits the given investment theme.

---

Theme Name: {theme_name}  
Theme Definition: {theme_definition}

---

Revenue Classification Hierarchy:
L1: {row['L1NAME']}_{row['L1DESCRIPTION']}  
L2: {row['L2NAME']}_{row['L2DESCRIPTION']}  
L3: {row['L3NAME']}_{row['L3DESCRIPTION']}  
L4: {row['L4NAME']}_{row['L4DESCRIPTION']}  
L5: {row['L5NAME']}_{row['L5DESCRIPTION']}  
L6: {row['L6NAME']}_{row['L6DESCRIPTION']}  ← This is the most specific category and should carry the highest weight in your decision.

---

**Strict Confidence Assignment Rules:**

- **High Confidence**:  
  - The L6 category and description are directly and primarily about the given theme.  
  - No other themes are equally or more relevant.  
  - The relationship to the theme definition is clear, specific, and strong.  
  - L6 must align closely with the theme definition; if L6 is not a strong match, do not assign High.

- **Medium Confidence**:  
  - The L6 is partially related to the theme, or  
  - The theme is relevant but not the main focus (other themes also apply), or  
  - There is some alignment at higher taxonomy levels (L1–L5) but L6 is less relevant.

- **Low Confidence**:  
  - The L6 category has no clear relationship to the theme definition.  
  - The match is vague, indirect, or primarily about unrelated topics.

**Special Instruction**:  
If other theme-related concepts (different from {theme_name}) appear in L6 or higher levels and share relevance, 
downgrade to Medium unless {theme_name} is clearly dominant.

---

**Answer format**:  
Confidence: [High / Medium / Low]  
Reason: [Short justification, 1–2 sentences explaining your choice, referencing L6 importance and any competing themes]
""".strip()
